# 실행 컨텍스트

## 23.1) 소스코드의 타입
- ECMAScript 사양은 소스코드를 4가지 타입으로 구분
### 전역 코드
- 전역변수를 관리하기 위해 최상위 스코프인 전역 스코프를 생성
- var 키워드로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수 전역 객체와 연결
### 함수 코드
- 지역변수, 매개변수, arguments 객체를 관리하기 위해 지역 스코프를 생성
### eval 코드
- strict 모드에서 자신만의 독자적인 스코프를 생성
### 모듈 코드
- 모듈별로 독립적인 모듈 스코프를 생성

## 23.2) 소스코드의 평가와 실행
- 자바스크립트 엔진은 소스코드를 소스코드의 평가와 소스코드의 실행 과정으로 나누어 처리
- 소스코드 평가 과정에서는 실행 컨텍스트를 생성하고 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록
- 소스코드 평가 과정이 끝나면 선언문을 제외한 소스코드가 순차적으로 실행 (런타임)

## 23.3) 실행 컨텍스트의 역할
- 실행 컨텍스트는 식별자를 등록하고 관리하는 스코프와 코드 실행 순서 관리를 구현한 내부 메커니즘
- 모든 코드는 실행 컨텍스트를 통해 실해되고 관리됨

## 23.4) 실행 컨텍스트 스택
- 실행 컨택스트 스택은 코드의 실행 순서를 관리
- 실행 중인 실행 컨텍스트는 항상 실행 컨텍스트 스택의 최상위에 존재

## 23.5) 렉시컬 환경
- 렉시컬 환경은 스코프를 구분하여 식별자를 등록하고 관리하는 저장소 역할을 하는 렉시컬 스코프의 실체
- 실행 컨텍스트는 LexicalEnviroment 컴포넌트와 VariableEnvironment 컴포넌트로 구성됨
- 실행 컨텍스트의 생성 초기에는 LexicalEnviroment 컴포넌트와 VariableEnvironment 컴포넌트는 동일한 렉시컬 환경을 참조하지만, strict 모드와, eval 코드, try/catch 같은 특수한 상황을 만나면 내용이 각 컴포넌트의 내용이 달라짐
- 렉시컬 환경은 환경 레코드 컴포넌트와 외부 렉시컬 환경에 대한 참조 컴포넌트로 구성됨
- 환경 레코드 : 스코프에 포함된 식별자를 등록하고 관리
- 외부 렉시컬 환경에 대한 참조 : 상위 스코프를 가리키며, 단방향 연결리스트로 스코프 체인을 구현함

## 23.6) 실행 컨텍스트의 생성과 식별자 검색 과정
### 전역 객체 생성
- 전역 객체는 전역 코드가 평가되기 이전에 생성됨
### 전역 코드 평가
#### 1. 전역 실행 컨텍스트 생성
#### 2. 전역 렉시컬 환경 실행
##### 객체 환경 레코드 생성
- 객체 환경 레코드는 var 키워드로 선언한 전역 변수와 함수 선언문으로 정의한 전역 함수, 빌트인 전역 프로퍼티와 빌트인 전역 함수, 표준 빌트인 객체를 관리
- 객체 환경 레코드는 BindingObject라고 부르는 전역객체와 연결됨
- BindingObject를 통해 전역 객체의 프로퍼티와 메서드가 됨
##### 선언적 환경 레코드 생성
- 선언적 환경 레코드는 let, const 키워드로 선언한 전역 변수를 관리
- 선언적 환경 레코드의 전역 변수는 선언 단계와 초기화 단계를 분리되어 진행
- 선언 단계 후에 초기화 단계에 도달하기 전까지 일시적 사각지대에 빠지게 됨
##### this 바인딩
- 전역객체가 바인딩 되어있는 [[GlobalThis]] 내부 슬롯에 this가 바인딩됨
##### 외부 렉시컬 환경에 대한 참조 결정
- 전역 렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 null을 할당
### 전역 코드 실행
- 전역 코드를 순차적으로 실행
- 식별자 결정을 위해 실행 중인 컨텍스트에서 식별자를 검색
### 함수 코드 평가
#### 1. 함수 실행 컨텍스트 생성
#### 2. 함수 렉시컬 환경 생성
##### 함수 환경 레코드 생성
- 함수 환경 레코드는 매개변수, arguments 객체, 함수 내부에서 선언한 지역 변수와 중첩 함수를 관리
##### this 바인딩
- 함수 호출 방식에 따라 정해지는 [[ThisValue]] 내부 슬롯에 this가 바인딩됨
##### 외부 렉시컬 환경에 대한 참조 결정
- 함수의 상위스코프를 함수 객체의 내부 슬롯 [[Enviroment]]에 저장
- 외부 렉시컬 환경에 대한 참조에 [[Enviroment]]에 저장된 렉시컬 환경을 할당
### 함수 코드 실행
- 함수 코드를 순차적으로 실행
- 식별자 결정을 위해 실행 중인 컨텍스트에서 식별자를 검색
### 함수 코드 실행 종료
### 전역 코드 실행 종료

## 23.7) 실행 컨텍스트와 블록 레벨 스코프
- let, const 키워드로 선언한 변수는 모든 코드 블록을 지역 스코프로 인정하는 블록 레벨 스코프를 따름